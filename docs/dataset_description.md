# INRIA Aerial Image Labeling Dataset

## Общее описание

**INRIA Aerial Image Labeling Dataset** — крупный публичный датасет для задачи **семантической сегментации зданий** на аэрофотоснимках. Создан исследователями из INRIA (Французского национального института исследований в области информатики и автоматики) в 2017 году.

Датасет специально спроектирован для проверки **способности моделей к обобщению** — тестовые города полностью отличаются от обучающих.

## Задача

Основная задача — **бинарная семантическая сегментация**: для каждого пикселя изображения необходимо определить, принадлежит ли он зданию или фону.

| Класс             | Значение пикселя          | Описание                      |
| ----------------- | ------------------------- | ----------------------------- |
| Фон (Background)  | 0                         | Дороги, деревья, вода, газоны |
| Здание (Building) | 255 (1 после бинаризации) | Жилые дома, офисы, склады     |

---

## Статистика датасета

| Параметр                          | Значение                |
| --------------------------------- | ----------------------- |
| Общее количество изображений      | 360                     |
| Обучающих изображений             | 180                     |
| Тестовых изображений              | 180                     |
| Размер одного изображения         | 5000 × 5000 пикселей    |
| Формат файлов                     | TIFF (GeoTIFF)          |
| Каналы                            | RGB (3 канала)          |
| Пространственное разрешение (GSD) | 30 см/пиксель           |
| Площадь одного снимка             | 1.5 × 1.5 км = 2.25 км² |
| Общая площадь покрытия            | ~810 км²                |
| Количество городов                | 10                      |
| Количество стран                  | 2 (США, Австрия)        |

---

## Структура датасета

```
data/raw/
├── train/
│   ├── images/           # 180 RGB изображений (5000×5000)
│   │   ├── austin1.tif
│   │   ├── austin2.tif
│   │   ├── ...
│   │   └── vienna36.tif
│   └── gt/               # 180 Ground Truth масок
│       ├── austin1.tif
│       ├── ...
│       └── vienna36.tif
└── test/
    └── images/           # 180 RGB изображений (без официальных масок)
        ├── bellingham1.tif
        ├── ...
        └── tyrol-e36.tif
```

---

## Города в датасете

Датасет охватывает **10 городов** из **2 стран** (США и Австрия):

### Обучающая выборка (train)

| Город         | Страна          | Изображений | Характер застройки    |
| ------------- | --------------- | ----------- | --------------------- |
| Austin        | США (Техас)     | 36          | Городская, смешанная  |
| Chicago       | США (Иллинойс)  | 36          | Плотная городская     |
| Kitsap County | США (Вашингтон) | 36          | Сельская/пригородная  |
| West Tyrol    | Австрия         | 36          | Горная местность      |
| Vienna        | Австрия         | 36          | Европейская городская |

### Тестовая выборка (test)

| Город         | Страна           | Изображений | Характер застройки    |
| ------------- | ---------------- | ----------- | --------------------- |
| Bellingham    | США (Вашингтон)  | 36          | Пригородная           |
| Bloomington   | США (Индиана)    | 36          | Университетский город |
| Innsbruck     | Австрия          | 36          | Горный город          |
| San Francisco | США (Калифорния) | 36          | Плотная городская     |
| East Tyrol    | Австрия          | 36          | Горная местность      |

> **Важно:** Города в train и test выборках **не пересекаются**. Это позволяет оценить способность модели обобщать на новые географические регионы.

---

## Формат данных

### Изображения (images)

- **Размер:** 5000 × 5000 пикселей
- **Каналы:** 3 (Red, Green, Blue)
- **Тип данных:** uint8 (значения 0-255)
- **Формат файла:** TIFF (GeoTIFF)

### Маски (gt — Ground Truth)

- **Размер:** 5000 × 5000 пикселей
- **Каналы:** 1 (grayscale)
- **Значения:** 0 (фон) или 255 (здание)
- **Формат файла:** TIFF

---

## Баланс классов

| Класс             | Средняя доля | Описание                      |
| ----------------- | ------------ | ----------------------------- |
| Фон (Background)  | ~84%         | Дороги, деревья, вода, газоны |
| Здания (Building) | ~16%         | Жилые дома, офисы, склады     |

**Соотношение классов примерно 5:1** — на каждый пиксель здания приходится 5 пикселей фона. Это типичный дисбаланс для задач сегментации зданий, требующий использования специализированных функций потерь (Dice Loss, Focal Loss).

---

## Пространственное разрешение

**30 см/пиксель (GSD)** означает, что один пиксель изображения соответствует квадрату 30×30 см на земле.

| Параметр                    | Расчёт              | Значение                |
| --------------------------- | ------------------- | ----------------------- |
| Площадь 1 пикселя           | 0.3 м × 0.3 м       | 0.09 м²                 |
| Площадь изображения         | 5000 × 5000 × 0.09  | 2 250 000 м² (2.25 км²) |
| Размер изображения на земле | 5000 × 0.3          | 1500 м × 1500 м         |

**Пример расчёта площади:**
> Если модель нашла 50 000 пикселей зданий: S = 50 000 × 0.09 = **4 500 м²**

---

## Использование в проекте

### Разбиение на train/validation

В проекте используется стратегия разбиения из оригинальной статьи:

| Выборка    | Тайлы               | Изображений | Назначение               |
| ---------- | ------------------- | ----------- | ------------------------ |
| Train      | 6-36 каждого города | 155         | Обучение модели          |
| Validation | 1-5 каждого города  | 25          | Оценка во время обучения |
| Test       | Отдельные города    | 180         | Финальная оценка         |

```python
# Константы из src/datasets/inria_dataset.py
TRAIN_CITIES = ["austin", "chicago", "kitsap", "tyrol-w", "vienna"]
TILES_PER_CITY = 36
VAL_TILES_PER_CITY = 5  # Первые 5 тайлов каждого города → validation
```

### Автоматически сгенерированные Ground Truth для теста

Официальная тестовая выборка **не содержит масок** (оценка производится через официальный сервер). Для локальной валидации в проекте используются автоматически сгенерированные маски (ансамбль SAM2 + YOLOv8, что разрешено техническим заданием):

```
data/processed/test/gt/
├── bellingham1.tif, bellingham10-18.tif    # 10 масок
├── bloomington1.tif, bloomington10-18.tif  # 10 масок
├── innsbruck1.tif, innsbruck10-18.tif      # 10 масок
├── sfo1.tif, sfo10-18.tif                  # 10 масок
└── tyrol-e1.tif, tyrol-e10-18.tif          # 10 масок
```

**Всего:** 50 тестовых изображений с автоматически сгенерированными масками.

### Обработка изображений

Изображения 5000×5000 не помещаются в GPU. Решение — **нарезка на тайлы**:

| Параметр              | Значение     | Обоснование                           |
| --------------------- | ------------ | ------------------------------------- |
| Размер тайла          | 512 × 512    | Баланс между контекстом и памятью GPU |
| Тайлов на изображение | 10           | Сколько случайных кропов за эпоху     |
| Overlap при inference | 128 пикселей | Устранение артефактов на границах     |

---

## Сложности датасета

1. **Вариативность крыш** — разные цвета, материалы, формы (плоские, скатные)
2. **Окклюзии** — здания частично скрыты деревьями
3. **Тени** — падающие тени могут быть похожи на здания
4. **Разная плотность застройки** — от небоскрёбов Chicago до ферм Kitsap
5. **Domain shift** — тестовые города визуально отличаются от обучающих

---

## Источник

- **Авторы:** Emmanuel Maggiori, Yuliya Tarabalka, Guillaume Charpiat, Pierre Alliez
- **Организация:** INRIA Sophia Antipolis
- **Год:** 2017
- **Публикация:** "Can Semantic Labeling Methods Generalize to Any City? The Inria Aerial Image Labeling Benchmark" (IGARSS 2017)
- **Лицензия:** Бесплатно для академического использования
- **Официальный сайт:** <https://project.inria.fr/aerialimagelabeling/>
